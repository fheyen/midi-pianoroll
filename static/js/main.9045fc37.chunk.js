(this["webpackJsonpmidi-pianoroll"]=this["webpackJsonpmidi-pianoroll"]||[]).push([[0],{18:function(t,e,i){t.exports=i(29)},23:function(t,e,i){},29:function(t,e,i){"use strict";i.r(e);var a=i(0),s=i.n(a),n=i(12),l=i.n(n),o=(i(23),i(13)),r=i.n(o),c=i(7),h=i(5),m=i(40),d=i(36),p=i(10),u=i(39),g=i(3),w=i(4);class f extends a.PureComponent{constructor(t,e={top:0,right:0,bottom:0,left:0},i=1,a=1,n=!0,l=!0){super(t),this.onResize=()=>{},this.increaseRows=()=>{const t=this.state,e=t.rowSpan,i=t.rowlimit,a=t.margin,s=t.canResizeRows,n=this.props.viewSize.outerHeight;if(!s)return;if(e>=i)return;const l=e+1,o=n*l;this.setState({rowSpan:l,viewHeight:o,height:o-a.top-a.bottom},this.onResize)},this.decreaseRows=()=>{const t=this.state,e=t.rowSpan,i=t.margin,a=t.canResizeRows,s=this.props.viewSize.outerHeight;if(!a)return;if(e<=1)return;const n=e-1,l=s*n;this.setState({rowSpan:n,viewHeight:l,height:l-i.top-i.bottom},this.onResize)},this.increaseColumns=()=>{const t=this.state,e=t.columnSpan,i=t.columnLimit,a=t.margin,s=t.canResizeColumns,n=this.props.viewSize.outerWidth;if(!s)return;if(e>=i)return;const l=e+1,o=n*l;this.setState({columnSpan:l,viewWidth:o,width:o-a.left-a.right},this.onResize)},this.decreaseColumns=()=>{const t=this.state,e=t.columnSpan,i=t.margin,a=t.canResizeColumns,s=this.props.viewSize.outerWidth;if(!a)return;if(e<=1)return;const n=e-1,l=s*n;this.setState({columnSpan:n,viewWidth:l,width:l-i.left-i.right},this.onResize)},this.close=()=>{const t=this.props,e=t.toggleView,i=t.name;e&&i&&e(i)},this.getSizeControlHTML=()=>s.a.createElement("div",{className:"sizeControl"},this.state.canResizeRows&&s.a.createElement("span",null,s.a.createElement("button",{onClick:this.increaseRows,title:"Increase rows",disabled:this.state.rowSpan>=this.state.rowlimit},s.a.createElement(g.a,{icon:w.b})),s.a.createElement("button",{onClick:this.decreaseRows,title:"Decrease rows",disabled:this.state.rowSpan<=1},s.a.createElement(g.a,{icon:w.d}))),this.state.canResizeColumns&&s.a.createElement("span",null,s.a.createElement("button",{onClick:this.increaseColumns,title:"Increase columns",disabled:this.state.columnSpan>=this.state.columnLimit},s.a.createElement(g.a,{icon:w.a})),s.a.createElement("button",{onClick:this.decreaseColumns,title:"Decrease columns",disabled:this.state.columnSpan<=1},s.a.createElement(g.a,{icon:w.c}))),s.a.createElement("button",{onClick:this.close,title:"Close"},s.a.createElement(g.a,{icon:w.e})));const o=t.viewSize,r=o.outerWidth,c=o.outerHeight,h=r*a,m=c*i;this.state={rowSpan:i,columnSpan:a,canResizeRows:n,canResizeColumns:l,rowlimit:12,columnLimit:2,outerWidth:r,outerHeight:c,viewHeight:m,viewWidth:h,margin:e,width:r*a-e.left-e.right,height:c*i-e.top-e.bottom}}resizeComponent(t={}){const e=this.props.viewSize,i=e.outerWidth,a=e.outerHeight,s=this.state,n=s.outerWidth,l=s.outerHeight,o=s.margin,r=s.rowSpan,h=s.columnSpan;if(n!==i||l!==a){const e=i*h,s=a*r;this.setState(Object(c.a)({},t,{outerWidth:i,outerHeight:a,viewWidth:e,viewHeight:s,width:i*h-o.left-o.right,height:a*r-o.top-o.bottom}),this.onResize)}}}var v=i(2),S=i(42);i(41),i(37),i(14),i(38);function b(t){var e=window.devicePixelRatio||1,i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e;var a=t.getContext("2d");return a.scale(e,e),a}function E(t,e,i,a,s,n){t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+s),t.lineTo(e+a,i+(s/2+n/2)),t.lineTo(e+a,i+(s/2-n/2)),t.closePath(),t.fill()}class x extends f{constructor(t){super(t,{top:35,right:20,bottom:40,left:55}),this.componentDidMount=()=>this.initialize(),this.onResize=()=>this.initialize(),this.initialize=()=>{const t=this.state,e=t.width,i=t.height,a=t.overviewHeight,s=t.yAxisLabelType,n=Object(u.a)(this.svg);n.selectAll("*").remove();const l=Object(m.a)().range([2,e]),o=Object(m.a)().range([2,e]),r=Object(m.a)().range([i,a+25]),c=Object(m.a)().range([a,0]),h=Object(p.a)(l),d=Object(p.b)(r);"note"===s&&d.tickFormat(t=>{var e;return null===(e=v.Midi.getMidiNoteByNr(t))||void 0===e?void 0:e.label});const g=n.append("g").attr("class","axis").attr("transform","translate(0, ".concat(i,")")).call(h),w=n.append("g").attr("class","axis").call(d);n.append("text").attr("class","yAxisLabel").text("Pitch").attr("transform","rotate(90) translate(".concat((i+a)/2,", ",45,")")),b(this.canvas),b(this.highlightCanvas),this.setState({initialized:!0,svg:n,x:l,xOv:o,y:r,yOv:c,xAxis:h,yAxis:d,xAxisEl:g,yAxisEl:w})},this.drawNotes=(t,e,i,a,s)=>{const n=this.state,l=n.width,o=n.margin,r=Object(m.a)().domain([0,127]).range([.1*i,i]);for(let c of e){const e=a(c.start),i=a(c.end);if(i<0||e>l)continue;const n=o.left+e,h=r(c.velocity);E(t,n,o.top+s(c.pitch)-h/2,Math.max(i-e,1),h,h/2)}},this.draw=()=>{const t=this.state,e=t.viewWidth,i=t.viewHeight,a=t.margin,s=t.width,n=t.height,l=t.overviewHeight,o=t.x,r=t.xOv,c=t.y,m=t.yOv,p=t.xAxis,u=t.yAxis,g=t.xAxisEl,w=t.yAxisEl,f=t.selectedTrack,b=t.showAllTime,E=this.props,x=E.midiFileData,y=E.timeSelection,R=this.canvas.getContext("2d");R.clearRect(0,0,e,i);const C=this.highlightCanvas.getContext("2d");let z;C.clearRect(0,0,e,i);let T=[];if(x&&x.length>0&&("all"===f?T=v.Utils.flattenArray(x):(z=Math.min(f,x.length-1),T=x[z])),0===T.length)return;const H=Object(d.a)(T,t=>t.end),O=Object(h.a)(H,2),A=O[0],k=O[1],M=[A<0?A:0,k];if(r.domain(M),b)o.domain(M);else{let t=[0,k];y&&(t=y),o.domain(t)}g.call(p);const N=Object(d.a)(T,t=>t.pitch),j=Object(h.a)(N,2),D=j[0],W=j[1];c.domain([+D-1,+W+1]),m.domain([+D-1,+W+1]),w.call(u);let I="all"===f?x:[x[z]];this.drawRowBandsForSharps(R,a,c,D,W,s,"rgba(128, 128, 128, 0.15)"),this.drawMeasures(R);const F=S.a,L=n/(W-D+3),P=l/(W-D+1);if(I.forEach((t,e)=>{R.fillStyle=F[e%F.length],this.drawNotes(R,t,L,o,c),this.drawNotes(R,t,P,r,m)}),R.fillStyle="#888",R.fillRect(a.left,a.top+l+12,s,1),function(t,e,i,a){t.clearRect(0,e.top,e.left,a),t.clearRect(e.left+i,e.top,e.right,a)}(R,a,s,n),y){const t=Object(h.a)(y,2),e=t[0],i=t[1];this.drawTimeSelection(C,e,i,"rgba(70, 130, 180, 0.2)")}this.drawCurrentPlayerTime(C)},this.drawRowBandsForSharps=(t,e,i,a,s,n,l="rgba(128, 128, 128, 0.1)")=>{const o=t.fillStyle;t.fillStyle=l;const r=i(0)-i(1),c=e.left;for(let h=a-1;h<=s+1;h++)if(v.Midi.isSharp(h)){const a=e.top+i(h)-r/2;t.fillRect(c,a,n,r)}t.fillStyle=o},this.drawMeasures=t=>{const e=this.props,i=e.xmlFileData,a=e.selectedTrack,s=this.state,n=s.margin,l=s.width,o=s.height,r=s.overviewHeight,c=s.x;if(!i)return;const h=i.parts["all"===a?0:a];t.fillStyle="rgba(128, 128, 128, 0.5)";const m=n.top+r+20,d=o-r-20;for(let p of h.measureLinePositions){const e=c(p);e<=0||e>l||t.fillRect(n.left+e,m,1,d)}},this.drawCurrentPlayerTime=t=>{const e=this.state,i=e.margin,a=e.height,s=e.overviewHeight,n=e.x,l=e.xOv,o=this.props.currentPlayerTime;null!==o&&(t.fillStyle="steelblue",t.fillRect(i.left+l(o),i.top,2,s),t.fillRect(i.left+n(o),i.top+s+25,2,a-s-25))},this.drawTimeSelection=(t,e,i,a)=>{const s=this.state,n=s.margin,l=s.height,o=s.overviewHeight,r=s.x,c=s.xOv;t.fillStyle=a;const h=n.left+c(e),m=n.left+c(i);t.fillRect(h,n.top,m-h,o);const d=n.left+r(e),p=n.left+r(i);t.fillRect(d,n.top+o+25,p-d,l-o-25)},this.handleBrushed=t=>{const e=this.state,i=e.margin,a=e.overviewHeight,s=e.xOv,n=e.brushStartEvent,l=this.props.setTimeSelection;if(!t||!n)return;const o=n.offsetX,r=n.offsetY,c=t.nativeEvent.offsetX;if(r<i.top||r>i.top+a)return;let m=s.invert(o-i.left),d=s.invert(c-i.left);const p=s.domain(),u=Object(h.a)(p,2),g=u[0],w=u[1];m=v.Utils.clipValue(m,g,w),d=v.Utils.clipValue(d,g,w);const f=v.Utils.swapSoSmallerFirst(m,d);f[1]-f[0]<1&&(f[1]=f[0]+1),l(f)},this.state=Object(c.a)({},this.state,{overviewHeight:80,showAllTime:!1,selectedTrack:"all",yAxisLabelType:"pitch",boxHeight:null,notes:[],liveNotes:[]})}componentDidUpdate(){this.resizeComponent(),this.state.initialized&&this.draw()}render(){const t=this.state,e=t.viewWidth,i=t.viewHeight,a=t.margin,n=this.props,l=n.midiFileData,o=n.selectedTrack;return s.a.createElement("div",{className:"View PitchTimeChart",style:{gridArea:"span ".concat(this.state.rowSpan," / span ").concat(this.state.columnSpan)}},s.a.createElement("canvas",{className:"ViewCanvas",ref:t=>this.canvas=t,style:{width:e,height:i},onMouseDownCapture:t=>this.setState({brushStartEvent:t.nativeEvent}),onMouseUpCapture:this.handleBrushed}),s.a.createElement("canvas",{className:"ViewCanvas HighlightCanvas",ref:t=>this.highlightCanvas=t,style:{width:e,height:i}}),s.a.createElement("svg",{width:e,height:i},s.a.createElement("text",{className:"heading",x:e/2,y:20},"MIDI Piano Roll"),s.a.createElement("g",{ref:t=>this.svg=t,transform:"translate(".concat(a.left,", ").concat(a.top,")")}),s.a.createElement("text",{className:"yAxisLabel",x:e/2,y:i-5},"Time in seconds")),s.a.createElement("div",{className:"viewControls"},s.a.createElement("select",{title:"MIDI track(s)",onChange:t=>this.setState({selectedTrack:t.target.value}),disabled:l.length>1&&"all"===o},s.a.createElement("option",{key:"all",value:"all"},"All tracks"),new Array(l.length).fill(0).map((t,e)=>s.a.createElement("option",{key:e,value:e,style:{background:S.a[e%S.a.length]}},"Track ",e))),s.a.createElement("select",{title:"Y-axis labels",onChange:t=>this.setState({yAxisLabelType:t.target.value},this.initialize)},s.a.createElement("option",{value:"pitch"},"MIDI note"),s.a.createElement("option",{value:"note"},"Note name")),s.a.createElement("button",{title:"Toggles between showing the whole time or a selection in the lower part",onClick:()=>this.setState({showAllTime:!this.state.showAllTime})},s.a.createElement(g.a,{icon:this.state.showAllTime?w.g:w.f}),"\xa0 Show whole time")))}}var y=i(15);class R extends a.Component{constructor(t){super(t),this.onResize=()=>{this.setState({viewSize:{outerWidth:Math.floor(window.innerWidth-20),outerHeight:Math.floor(window.innerHeight-200)}})},this.setTimeSelection=t=>{this.setState({timeSelection:t,similarSections:[]})},this.state={viewSize:{outerWidth:800,outerHeight:600},midiFileData:[],timeSelection:null}}componentDidMount(){window.addEventListener("resize",this.onResize,!1),this.onResize();let t=document.getElementById("filereader");const e=this;r.a.parse(t,(function(t){try{const i=Object(v.preprocessMidiFileData)(t).parts.map(t=>t.noteObjs);e.setState({midiFileData:i})}catch(i){alert("Invalid MIDI file or wrong format!")}}))}render(){const t=this.state;return s.a.createElement("div",{className:"App dark"},s.a.createElement("div",{className:"fileSelection"},s.a.createElement("input",{className:"fileInput",type:"file",id:"filereader"})),s.a.createElement(x,{name:"Note-Time Chart",viewSize:t.viewSize,midiFileData:t.midiFileData,timeSelection:t.timeSelection,setTimeSelection:this.setTimeSelection}),s.a.createElement("div",{className:"githubLink"},s.a.createElement("a",{href:"https://github.com/fheyen/midi-pianoroll"},s.a.createElement(g.a,{icon:y.a}),"\xa0 https://github.com/fheyen/midi-pianoroll")))}}l.a.render(s.a.createElement(R,null),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.9045fc37.chunk.js.map