(this["webpackJsonpmidi-pianoroll"]=this["webpackJsonpmidi-pianoroll"]||[]).push([[0],{34:function(e,t,i){},41:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i(4),r=i.n(n),o=i(22),l=i.n(o),s=i(7),c=i(8),h=i(10),d=i(9),u=(i(34),i(23)),v=i.n(u),f=i(11),m=i(13),g=i(2),p=i(52),b=i(48),j=i(20),w=i(51),x=i(5),O=i(6),S=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{top:0,right:0,bottom:0,left:0},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Object(s.a)(this,i),(n=t.call(this,e)).onResize=function(){},n.increaseRows=function(){var e=n.state,t=e.rowSpan,i=e.rowlimit,a=e.margin,r=e.canResizeRows,o=n.props.viewSize.outerHeight;if(r&&!(t>=i)){var l=t+1,s=o*l;n.setState({rowSpan:l,viewHeight:s,height:s-a.top-a.bottom},n.onResize)}},n.decreaseRows=function(){var e=n.state,t=e.rowSpan,i=e.margin,a=e.canResizeRows,r=n.props.viewSize.outerHeight;if(a&&!(t<=1)){var o=t-1,l=r*o;n.setState({rowSpan:o,viewHeight:l,height:l-i.top-i.bottom},n.onResize)}},n.increaseColumns=function(){var e=n.state,t=e.columnSpan,i=e.columnLimit,a=e.margin,r=e.canResizeColumns,o=n.props.viewSize.outerWidth;if(r&&!(t>=i)){var l=t+1,s=o*l;n.setState({columnSpan:l,viewWidth:s,width:s-a.left-a.right},n.onResize)}},n.decreaseColumns=function(){var e=n.state,t=e.columnSpan,i=e.margin,a=e.canResizeColumns,r=n.props.viewSize.outerWidth;if(a&&!(t<=1)){var o=t-1,l=r*o;n.setState({columnSpan:o,viewWidth:l,width:l-i.left-i.right},n.onResize)}},n.close=function(){var e=n.props,t=e.toggleView,i=e.name;t&&i&&t(i)},n.getSizeControlHTML=function(){return Object(a.jsxs)("div",{className:"sizeControl",children:[n.state.canResizeRows&&Object(a.jsxs)("span",{children:[Object(a.jsx)("button",{onClick:n.increaseRows,title:"Increase rows",disabled:n.state.rowSpan>=n.state.rowlimit,children:Object(a.jsx)(x.a,{icon:O.b})}),Object(a.jsx)("button",{onClick:n.decreaseRows,title:"Decrease rows",disabled:n.state.rowSpan<=1,children:Object(a.jsx)(x.a,{icon:O.d})})]}),n.state.canResizeColumns&&Object(a.jsxs)("span",{children:[Object(a.jsx)("button",{onClick:n.increaseColumns,title:"Increase columns",disabled:n.state.columnSpan>=n.state.columnLimit,children:Object(a.jsx)(x.a,{icon:O.a})}),Object(a.jsx)("button",{onClick:n.decreaseColumns,title:"Decrease columns",disabled:n.state.columnSpan<=1,children:Object(a.jsx)(x.a,{icon:O.c})})]}),Object(a.jsx)("button",{onClick:n.close,title:"Close",children:Object(a.jsx)(x.a,{icon:O.e})})]})};var d=e.viewSize,u=d.outerWidth,v=d.outerHeight,f=u*l,m=v*o;return n.state={rowSpan:o,columnSpan:l,canResizeRows:c,canResizeColumns:h,rowlimit:12,columnLimit:2,outerWidth:u,outerHeight:v,viewHeight:m,viewWidth:f,margin:r,width:u*l-r.left-r.right,height:v*o-r.top-r.bottom},n}return Object(c.a)(i,[{key:"resizeComponent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props.viewSize,i=t.outerWidth,a=t.outerHeight,n=this.state,r=n.outerWidth,o=n.outerHeight,l=n.margin,s=n.rowSpan,c=n.columnSpan;if(r!==i||o!==a){var h=i*c,d=a*s;this.setState(Object(f.a)(Object(f.a)({},e),{},{outerWidth:i,outerHeight:a,viewWidth:h,viewHeight:d,width:i*c-l.left-l.right,height:a*s-l.top-l.bottom}),this.onResize)}}}]),i}(n.PureComponent),y=i(3),R=i(54);i(53),i(49),i(24),i(50);function C(e){var t=window.devicePixelRatio||1,i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t;var a=e.getContext("2d");return a.scale(t,t),a}function z(e,t,i,a,n,r){e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+n),e.lineTo(t+a,i+(n/2+r/2)),e.lineTo(t+a,i+(n/2-r/2)),e.closePath(),e.fill()}var T=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var a;Object(s.a)(this,i);return(a=t.call(this,e,{top:35,right:20,bottom:40,left:55})).componentDidMount=function(){return a.initialize()},a.onResize=function(){return a.initialize()},a.initialize=function(){var e=a.state,t=e.width,i=e.height,n=e.overviewHeight,r=e.yAxisLabelType,o=Object(w.a)(a.svg);o.selectAll("*").remove();var l=Object(p.a)().range([2,t]),s=Object(p.a)().range([2,t]),c=Object(p.a)().range([i,n+25]),h=Object(p.a)().range([n,0]),d=Object(j.a)(l),u=Object(j.b)(c);"note"===r&&u.tickFormat((function(e){var t;return null===(t=y.Midi.getMidiNoteByNr(e))||void 0===t?void 0:t.label}));var v=o.append("g").attr("class","axis").attr("transform","translate(0, ".concat(i,")")).call(d),f=o.append("g").attr("class","axis").call(u);o.append("text").attr("class","yAxisLabel").text("Pitch").attr("transform","rotate(90) translate(".concat((i+n)/2,", ",45,")")),C(a.canvas),C(a.highlightCanvas),a.setState({initialized:!0,svg:o,x:l,xOv:s,y:c,yOv:h,xAxis:d,yAxis:u,xAxisEl:v,yAxisEl:f})},a.drawNotes=function(e,t,i,n,r){var o,l=a.state,s=l.width,c=l.margin,h=Object(p.a)().domain([0,127]).range([.1*i,i]),d=Object(g.a)(t);try{for(d.s();!(o=d.n()).done;){var u=o.value,v=n(u.start),f=n(u.end);if(!(f<0||v>s)){var m=c.left+v,b=h(u.velocity);z(e,m,c.top+r(u.pitch)-b/2,Math.max(f-v,1),b,b/2)}}}catch(j){d.e(j)}finally{d.f()}},a.draw=function(){var e=a.state,t=e.viewWidth,i=e.viewHeight,n=e.margin,r=e.width,o=e.height,l=e.overviewHeight,s=e.x,c=e.xOv,h=e.y,d=e.yOv,u=e.xAxis,v=e.yAxis,f=e.xAxisEl,g=e.yAxisEl,p=e.selectedTrack,j=e.showAllTime,w=a.props,x=w.midiFileData,O=w.timeSelection,S=a.canvas.getContext("2d");S.clearRect(0,0,t,i);var C,z=a.highlightCanvas.getContext("2d");z.clearRect(0,0,t,i);var T=[];if(x&&x.length>0&&(T="all"===p?y.Utils.flattenArray(x):x[C=Math.min(p,x.length-1)]),0!==T.length){var H=Object(b.a)(T,(function(e){return e.end})),k=Object(m.a)(H,2),A=k[0],M=k[1],N=[A<0?A:0,M];if(c.domain(N),j)s.domain(N);else{var D=[0,M];O&&(D=O),s.domain(D)}f.call(u);var W=Object(b.a)(T,(function(e){return e.pitch})),I=Object(m.a)(W,2),E=I[0],F=I[1];h.domain([+E-1,+F+1]),d.domain([+E-1,+F+1]),g.call(v);var L="all"===p?x:[x[C]];a.drawRowBandsForSharps(S,n,h,E,F,r,"rgba(128, 128, 128, 0.15)"),a.drawMeasures(S);var P=R.a,B=o/(F-E+3),U=l/(F-E+1);if(L.forEach((function(e,t){S.fillStyle=P[t%P.length],a.drawNotes(S,e,B,s,h),a.drawNotes(S,e,U,c,d)})),S.fillStyle="#888",S.fillRect(n.left,n.top+l+12,r,1),function(e,t,i,a){e.clearRect(0,t.top,t.left,a),e.clearRect(t.left+i,t.top,t.right,a)}(S,n,r,o),O){var V=Object(m.a)(O,2),J=V[0],X=V[1];a.drawTimeSelection(z,J,X,"rgba(70, 130, 180, 0.2)")}a.drawCurrentPlayerTime(z)}},a.drawRowBandsForSharps=function(e,t,i,a,n,r){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"rgba(128, 128, 128, 0.1)",l=e.fillStyle;e.fillStyle=o;for(var s=i(0)-i(1),c=t.left,h=a-1;h<=n+1;h++)if(y.Midi.isSharp(h)){var d=t.top+i(h)-s/2;e.fillRect(c,d,r,s)}e.fillStyle=l},a.drawMeasures=function(e){var t=a.props,i=t.xmlFileData,n=t.selectedTrack,r=a.state,o=r.margin,l=r.width,s=r.height,c=r.overviewHeight,h=r.x;if(i){var d=i.parts["all"===n?0:n];e.fillStyle="rgba(128, 128, 128, 0.5)";var u,v=o.top+c+20,f=s-c-20,m=Object(g.a)(d.measureLinePositions);try{for(m.s();!(u=m.n()).done;){var p=h(u.value);p<=0||p>l||e.fillRect(o.left+p,v,1,f)}}catch(b){m.e(b)}finally{m.f()}}},a.drawCurrentPlayerTime=function(e){var t=a.state,i=t.margin,n=t.height,r=t.overviewHeight,o=t.x,l=t.xOv,s=a.props.currentPlayerTime;null!==s&&(e.fillStyle="steelblue",e.fillRect(i.left+l(s),i.top,2,r),e.fillRect(i.left+o(s),i.top+r+25,2,n-r-25))},a.drawTimeSelection=function(e,t,i,n){var r=a.state,o=r.margin,l=r.height,s=r.overviewHeight,c=r.x,h=r.xOv;e.fillStyle=n;var d=o.left+h(t),u=o.left+h(i);e.fillRect(d,o.top,u-d,s);var v=o.left+c(t),f=o.left+c(i);e.fillRect(v,o.top+s+25,f-v,l-s-25)},a.handleBrushed=function(e){var t=a.state,i=t.margin,n=t.overviewHeight,r=t.xOv,o=t.brushStartEvent,l=a.props.setTimeSelection;if(e&&o){var s=o.offsetX,c=o.offsetY,h=e.nativeEvent.offsetX;if(!(c<i.top||c>i.top+n)){var d=r.invert(s-i.left),u=r.invert(h-i.left),v=r.domain(),f=Object(m.a)(v,2),g=f[0],p=f[1];d=y.Utils.clipValue(d,g,p),u=y.Utils.clipValue(u,g,p);var b=y.Utils.swapSoSmallerFirst(d,u);b[1]-b[0]<1&&(b[1]=b[0]+1),l(b)}}},a.state=Object(f.a)(Object(f.a)({},a.state),{},{overviewHeight:80,showAllTime:!1,selectedTrack:"all",yAxisLabelType:"pitch",boxHeight:null,notes:[],liveNotes:[]}),a}return Object(c.a)(i,[{key:"componentDidUpdate",value:function(){this.resizeComponent(),this.state.initialized&&this.draw()}},{key:"render",value:function(){var e=this,t=this.state,i=t.viewWidth,n=t.viewHeight,r=t.margin,o=this.props,l=o.midiFileData,s=o.selectedTrack;return Object(a.jsxs)("div",{className:"View PitchTimeChart",style:{gridArea:"span ".concat(this.state.rowSpan," / span ").concat(this.state.columnSpan)},children:[Object(a.jsx)("canvas",{className:"ViewCanvas",ref:function(t){return e.canvas=t},style:{width:i,height:n},onMouseDownCapture:function(t){return e.setState({brushStartEvent:t.nativeEvent})},onMouseUpCapture:this.handleBrushed}),Object(a.jsx)("canvas",{className:"ViewCanvas HighlightCanvas",ref:function(t){return e.highlightCanvas=t},style:{width:i,height:n}}),Object(a.jsxs)("svg",{width:i,height:n,children:[Object(a.jsx)("text",{className:"heading",x:i/2,y:20,children:"MIDI Piano Roll"}),Object(a.jsx)("g",{ref:function(t){return e.svg=t},transform:"translate(".concat(r.left,", ").concat(r.top,")")}),Object(a.jsx)("text",{className:"yAxisLabel",x:i/2,y:n-5,children:"Time in seconds"})]}),Object(a.jsxs)("div",{className:"viewControls",children:[Object(a.jsxs)("select",{title:"MIDI track(s)",onChange:function(t){return e.setState({selectedTrack:t.target.value})},disabled:l.length>1&&"all"===s,children:[Object(a.jsx)("option",{value:"all",children:"All tracks"},"all"),new Array(l.length).fill(0).map((function(e,t){return Object(a.jsxs)("option",{value:t,style:{background:R.a[t%R.a.length]},children:["Track ",t]},t)}))]}),Object(a.jsxs)("select",{title:"Y-axis labels",onChange:function(t){return e.setState({yAxisLabelType:t.target.value},e.initialize)},children:[Object(a.jsx)("option",{value:"pitch",children:"MIDI note"}),Object(a.jsx)("option",{value:"note",children:"Note name"})]}),Object(a.jsxs)("button",{title:"Toggles between showing the whole time or a selection in the lower part",onClick:function(){return e.setState({showAllTime:!e.state.showAllTime})},children:[Object(a.jsx)(x.a,{icon:this.state.showAllTime?O.g:O.f}),"\xa0 Show whole time"]})]})]})}}]),i}(S),H=i(25),k=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(s.a)(this,i),(a=t.call(this,e)).onResize=function(){a.setState({viewSize:{outerWidth:Math.floor(window.innerWidth-20),outerHeight:Math.floor(window.innerHeight-200)}})},a.setTimeSelection=function(e){a.setState({timeSelection:e,similarSections:[]})},a.state={viewSize:{outerWidth:800,outerHeight:600},midiFileData:[],timeSelection:null},a}return Object(c.a)(i,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize,!1),this.onResize();var e=document.getElementById("filereader"),t=this;v.a.parse(e,(function(e){try{var i=Object(y.preprocessMidiFileData)(e).parts.map((function(e){return e.noteObjs}));t.setState({midiFileData:i})}catch(a){alert("Invalid MIDI file or wrong format!")}}))}},{key:"render",value:function(){var e=this.state;return Object(a.jsxs)("div",{className:"App dark",children:[Object(a.jsx)("div",{className:"fileSelection",children:Object(a.jsx)("input",{className:"fileInput",type:"file",id:"filereader"})}),Object(a.jsx)(T,{name:"Note-Time Chart",viewSize:e.viewSize,midiFileData:e.midiFileData,timeSelection:e.timeSelection,setTimeSelection:this.setTimeSelection}),Object(a.jsx)("div",{className:"githubLink",children:Object(a.jsxs)("a",{href:"https://github.com/fheyen/midi-pianoroll",children:[Object(a.jsx)(x.a,{icon:H.a}),"\xa0 https://github.com/fheyen/midi-pianoroll"]})})]})}}]),i}(n.Component);l.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(k,{})}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.ee55ef86.chunk.js.map